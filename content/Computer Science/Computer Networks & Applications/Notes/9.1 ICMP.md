> [!idea] ICMP: Purpose and Relation to IP
> ICMP (Internet Control Message Protocol) is used by hosts and routers to **communicate network-layer information**
> - Primary use: **error reporting** (e.g., "Destination network unreachable")
> - ICMP lies just above IP in the protocol stack
>   - ICMP messages are **carried as IP payload**, like TCP or UDP segments
>   - When a host receives an IP datagram with ICMP as the upper-layer protocol (protocol number 1), it demultiplexes the datagram's contents to ICMP
>
> ICMP messages have the following format:
> 
> | Field | Description |
> |-------|-------------|
> | Type  | Specifies the type of ICMP message |
> | Code  | Provides additional information about the message type |
> | Header and first 8 bytes of the IP datagram | Helps the sender determine the datagram that caused the error |

> [!idea] ICMP Message Types and Uses
> - ICMP messages are used for various purposes, not just error reporting
> - Examples:
>   - Ping: Type 8 Code 0 (echo request), Type 0 Code 0 (echo reply)
>   - Source Quench: Used for congestion control (rarely used in practice)
>   - Traceroute: Utilizes ICMP Time Exceeded (Type 11 Code 0) and Port Unreachable (Type 3 Code 3) messages

> [!example] Traceroute Implementation Using ICMP
> ![Traceroute Diagram](traceroute_diagram.png)
> 1. Source sends a series of IP datagrams to the destination, each with increasing TTL values
> 2. Routers along the path discard datagrams with expired TTL and send ICMP Time Exceeded messages back to the source
> 3. Destination host sends ICMP Port Unreachable message when it receives a datagram with an unlikely UDP port number
> 4. Source learns the number, identities, and round-trip times of routers between itself and the destination

> [!consider] ICMPv6
> - A new version of ICMP has been defined for IPv6 in RFC 4443
> - ICMPv6 reorganizes existing ICMP type and code definitions and adds new types and codes required by IPv6 functionality
>   - Examples: "Packet Too Big" type and "unrecognized IPv6 options" error code

Please let me know if you have any questions or if you would like me to modify the notes in any way.