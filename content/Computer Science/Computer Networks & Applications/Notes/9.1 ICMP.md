> [!idea] ICMP: Purpose and Relation to IP
> ICMP (Internet Control Message Protocol) is used by hosts and routers to **communicate network-layer information**.
> - Primary use: **error reporting** (e.g., "Destination network unreachable")
> - ICMP lies **just above IP** in the protocol stack
>   - ICMP messages are **carried as IP payload**, like TCP or UDP segments
>   - When a host receives an IP datagram with ICMP as the upper-layer protocol (protocol number 1), it demultiplexes the datagram's contents to ICMP
>
> ICMP messages have the following format:
> 
> | Field | Description |
> |-------|-------------|
> | Type  | Specifies the type of ICMP message |
> | Code  | Provides additional information about the message type |
> | Header and first 8 bytes of the IP datagram | Helps the sender determine the datagram that caused the error |

> [!idea] ICMP Message Types and Uses
> - ICMP messages are used for various purposes, **not just error reporting**
> - Examples:
>   - Ping: Type 8 Code 0 (echo request), Type 0 Code 0 (echo reply)
>   - Source Quench: Used for congestion control (rarely used in practice)
>   - Traceroute: Utilizes ICMP Time Exceeded (Type 11 Code 0) and Port Unreachable (Type 3 Code 3) messages

> [!example] Ping: Testing Reachability Using ICMP
> ![[Ping-command 1.png]]
> Ping is a basic network utility used to **test the reachability of a host on an IP network**. It uses ICMP echo request and echo reply messages to determine whether a host is accessible and to measure the round-trip time (RTT) for the messages.
>
> Here's how ping works:
>
> 1. The source host sends an ICMP echo request message (Type 8, Code 0) to the target host's IP address.
> 2. If the target host is reachable, it receives the ICMP echo request message and sends an ICMP echo reply message (Type 0, Code 0) back to the source host.
> 3. The source host receives the ICMP echo reply message and calculates the RTT based on the time difference between sending the request and receiving the reply.
> 4. If the target host is not reachable or does not respond within a specified timeout, the source host will not receive an echo reply message.


> [!example] Traceroute
> ![Traceroute Diagram](traceroute_diagram.png)
> Traceroute is a tool that discovers the path and measures the latency between a source and a destination host on a network. It works by sending a series of UDP packets with increasing Time to Live (TTL) values and analyzing the ICMP error messages generated by routers along the path.
>
> Here's how Traceroute works:
>
> 1. The source sends a series of UDP packets to the destination, each with an increasing TTL value (starting from 1) and an unlikely destination port number.
> 2. Each router along the path decrements the TTL by 1 before forwarding the packet. When a router receives a packet with a TTL of 1, it decrements the TTL to 0, discards the packet, and sends an ICMP Time Exceeded message back to the source.
> 3. The source records the IP address of each router that sends an ICMP Time Exceeded message, along with the round-trip time (RTT) between sending the UDP packet and receiving the ICMP message. This indicates that the packet successfully reached that router.
> 4. When a packet finally reaches the destination host, the destination sends an ICMP Port Unreachable message back to the source because the UDP port is unlikely to be in use.
> 5. The source stops sending packets once it receives the ICMP Port Unreachable message.
>
> By analyzing the ICMP Time Exceeded and Port Unreachable messages, Traceroute determines the path and measures the RTT for each hop between the source and the destination. Each ICMP Time Exceeded message indicates a successful hop, while the ICMP Port Unreachable message signifies that the destination has been reached.



> [!consider] ICMPv6
> - A new version of ICMP has been defined for IPv6 in RFC 4443
> - ICMPv6 reorganizes existing ICMP type and code definitions and adds new types and codes required by IPv6 functionality
>   - Examples: "Packet Too Big" type and "unrecognized IPv6 options" error code

Please let me know if you have any questions or if you would like me to modify the notes in any way.