## GET and POST Requests

### GET
- Used for requesting a resource from a server
- No request body
- Cannot send large amounts of data to server
- Can have URL paramters for small amounts of data

#### GET Request with Paramters
- Paramters placed at the end of URL
	- Consist of `name=value` pairs, preceeded by `?` and seperated by `&`
- Must be a valid URL; may require encoding the names / values
- eg
	- `/page.html?param1=value1¶m2=more%20complex%2C%20fancy%20%26%20encoded%20value`

#### Sending a GET Request with Parameters

##### Through a form submit
- A HTML form, when submitted can be used to send a GET request with additional parameters
- Browser will load response as a new page

```html
<form action="/page.html" method="get">
 <input type="text" name="q" value="Enter your search term here" />
 <input type="submit" value="Search" />
</form>
```

- Causes the browser to send a GET request for the page at `/page.html?q=text`

![[docs/Images/Pasted image 20230424120001.png]]

##### Using AJAX
- Use string concatenation to construct the URL
- May need to encode values before sending

```js
// Create new AJAX request
var xhttp = new XMLHttpRequest();

// Define behaviour for a response
xhttp.onreadystatechange = function() {
 if (this.readyState == 4 && this.status == 200) {
	 // do stuff if successful
 }
};

// Initiate connection
xhttp.open("GET", "page.html?param1="+encodeURIComponent(value1)+"&param2="+encodeURIComponent(value2), true);

// Send request
xhttp.send();
```

##### As a link
- Since the parameters are contained in the URL, you can just provide a link
- Browser will load link as a new page, so response should be a full HTML page

#### Handling GET Request Paramters in Express
- Use the request object
	- `req.query` is automatically generated as an object who's keys are the request parameters
	- For a query parameter named `param1`, we can access its value from `req.query.param1`
- Defined in `app.js`

```js
app.use(express.urlencoded( { extended: false }));
```

- Use in any of your routes eg. `routes/index.js`

```js
router.get('/page.html', function(req, res) { 
	var q = req.query.param1; 
	res.send('You searched for '+q); 
});
```


### POST
- Used for sending data to a server, can be large
- Contains a request body

#### Sending a POST Request

##### Through a Form Submit
- Similar to GET
- Search terms won't appear in URL
- Preferred methods for passwords

```js
<form action="/page.html" method="post">
 <input type="text" name="q" value="Enter your search term here" />
 <input type="submit" value="Search" />
</form>
```

![[docs/Images/Pasted image 20230424124946.png]]

##### Using AJAX

- Put content in `send()` call

```js
// Create new AJAX request
var xhttp = new XMLHttpRequest(); 

// Define behaviour for a response 
xhttp.onreadystatechange = function() { 
	if (this.readyState == 4 && this.status == 200) { 
		// do stuff if successful 
	} }
; 
		
// Initiate connection 
xhttp.open("POST", "page.html"), true); 

// Send request 
xhttp.send("Some string that is the body of my request");
```

##### Handling a POST body in Express
- Use the request object
	- `req.body` is automatically as a string containing the request body
- Use in any of your routes

```js
router.post('/page.html', function(req, res) { 
	var text = req.body; 
	res.send('You sent '+text); 
});
```

### Handling Body Encodings
- Express generator provides middleware to automatically handle different request encodings
	- JSON or form data requests will automatically be parsed into an object by express if your request is properly set up
- For the request body generated by a form submission

```js
<form action="/page.html" method="post">
 <input type="text" name="q" value="Some text" />
 <input type="submit" value="Search" />
</form>
```

- `req.body` contains the object parsed

```js
router.post('/page.html', function(req, res) { 
	var p1 = req.body.q; // will be "Some text" 
	var p2 = req.body.submit; // will be "Search" res.send(); 
});
```

- This can be done in AJAX by setting the request's `content-type` header to `application/json`

```js
// Create new AJAX request
var xhttp = new XMLHttpRequest();

// Define behaviour for a response
xhttp.onreadystatechange = function() {
 if (this.readyState == 4 && this.status == 200) {
 // do stuff if successful
 }
};

// Initiate connection
xhttp.open("POST", "search.html", true);

// Set content type to JSON
xhttp.setRequestHeader("Content-type", "application/json");

// Send request
xhttp.send(JSON.stringify({param1:"value1", param2:2}));
```

## Dynamic URLs

### Parameterised URLs in Express

- Sometimes we want to have custom URL paths
- e.g. URLs for each user like `/user/bob` and `/user/alice`
- Express provides a method to do this using parameterised URL paths
	- Use `:paramName` in the path
	- Access via `req.params.paramName`

```js
router.get('/user/:id', function(req, res) {
 // The value of id is accessible as a variable
 res.send('user ' + req.params.id);
});

router.get('/author/:authorId/page/:pNum', function(req, res) {
 // A route can have multiple parameters in the URL path in different places
});
```